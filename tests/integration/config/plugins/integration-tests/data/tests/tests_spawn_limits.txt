test-data "Spawn Limits Test"
	category "savegame"
	contents
		pilot Bobbi Bughunter
		date 16 11 3013
		system "Terra Incognita"
		planet Ruin
		clearance
		ship "Star Barge"
			name "Buggy Barge"
			sprite "ship/star barge"
			attributes
				category "Light Freighter"
				cost 190000
				mass 70
				bunks 3
				"cargo space" 50
				drag 2.1
				"engine capacity" 40
				"fuel capacity" 300
				"heat dissipation" 0.8
				hull 1000
				"outfit space" 130
				"required crew" 1
				shields 600
				"turret mounts" 1
				"weapon capacity" 20
				"thrust" 100
				"reverse thrust" 100
				"turn" 1000
				"energy generation" 10
			outfits
				Hyperdrive
			crew 1
			fuel 300
			shields 600
			hull 1000
			position 0 0
			engine -9 38 1
			engine 9 38 1
			system "Terra Incognita"
			planet Ruin
		account
			credits 100000000
			score 400
			history
		visited "Terra Incognita"
		"visited planet" Ruin
		conditions
			"Ruin: Landing: offered"
		event
			date 1 1 3012
			system "Terra Incognita"
				fleet "Non-Disabled A Test Fleet"
					category test
					period 1
					non-disabled limit 1
					ignore enemy strength
				fleet "Disabled B Test Fleet"
					category test
					period 1
					limit 3
					ignore enemy strength
				fleet "Disabled C Test Fleet"
					category test
					period 1
					limit 0
					initial count 1
					ignore enemy strength
				fleet "Disabled 2 Test Fleet"
					period 100000000
					limit 0
					initial count 1



fleet "Non-Disabled A Test Fleet"
	government "Test Government 1 A"
	cargo 0
	personality staying heroic
	variant 60
		"Aphid"

fleet "Disabled B Test Fleet"
	government "Test Government 1 B"
	cargo 0
	personality staying derelict heroic
	variant 60
		"Star Barge"

fleet "Disabled C Test Fleet"
	government "Test Government 1 C"
	cargo 0
	personality staying derelict heroic
	variant 60
		"Shuttle"

government "Test Government 1 A"
	swizzle 2
	color 1 1 1
	"player reputation" 1e9
	"fine" 0
	"attitude toward"
		"Test Government 2" -1

government "Test Government 1 B"
	swizzle 2
	color 1 1 1
	"player reputation" 1e9
	"fine" 0
	"attitude toward"
		"Test Government 2" -1

government "Test Government 1 C"
	swizzle 3
	color 1 1 1
	"player reputation" 1e9
	"fine" 0
	"attitude toward"
		"Test Government 2" -1

government "Test Government 2"
	swizzle 4
	color 1 1 1
	"player reputation" 1e9
	"fine" 0
	"attitude toward"
		"Test Government 1 A" -1
		"Test Government 1 B" -1
		"Test Government 1 C" -1

mission "Board 1 A"
	assisting
	repeat
	source
		government "Test Government 1 A"
	on offer
		"test: Test Government 1 A boarded" ++
	destination "Earth"

mission "Board 1 B"
	assisting
	repeat
	source
		government "Test Government 1 B"
	on offer
		"test: Test Government 1 B boarded" ++
	destination "Earth"

mission "Board 1 C"
	assisting
	repeat
	source
		government "Test Government 1 C"
	on offer
		"test: Test Government 1 C boarded" ++
	destination "Earth"

mission "Board 2"
	assisting
	repeat
	source
		government "Test Government 2"
	on offer
		"test: Test Government 2 boarded" ++
	destination "Earth"

ship "Kasichara A'awoj" "Big Ship"
	outfits
		"Triple Plasma Core"
		"Systems Core (Large)"
		"Systems Core (Small)"
		"Large Heat Shunt" 2
		"Small Heat Shunt" 3
		"Fuel Processor" 2
		"Luxury Accommodations"
		"Microbot Defense Station" 23
		"Thermal Repeater Rifle" 548

fleet "Disabled 2 Test Fleet"
	government "Test Government 2"
	cargo 0
	personality staying derelict
	variant 60
		"Big Ship"



test "Spawn Limit Tests"
	status active
	description "Tests if the AI can use the afterburner as regular thruster for departure and landing."
	sequence
		inject "Spawn Limits Test"
		call "Load First Savegame"
		watchdog 12000
		call "Depart"
		# Wait for 10 seconds to drift away from the planet.
		apply
			"test: steps to wait" = 10 * 60
		# empty input to make time pass
		input

		# Board first ship.
		input
			command board
		apply
			"test: steps to wait" = 3 * 60
		label wait1
		apply
			"test: steps to wait" = "test: steps to wait" - 1
		branch wait1
			"test: steps to wait" > 0

		# Board second ship.
		input
			command board
		apply
			"test: steps to wait" = 3 * 60
		label wait2
		apply
			"test: steps to wait" = "test: steps to wait" - 1
		branch wait2
			"test: steps to wait" > 0

		# Board third ship.
		input
			command board
		apply
			"test: steps to wait" = 3 * 60
		label wait3
		apply
			"test: steps to wait" = "test: steps to wait" - 1
		branch wait3
			"test: steps to wait" > 0

		# Hopefully board no other ships.
		input
			command board
		apply
			"test: steps to wait" = 3 * 60
		label wait4
		apply
			"test: steps to wait" = "test: steps to wait" - 1
		branch wait4
			"test: steps to wait" > 0

		assert
			not "test: Test Government 1 A boarded"
		assert
			"test: Test Government 1 B boarded" == 1
		assert
			"test: Test Government 1 C boarded" == 1
		assert
			"test: Test Government 2 boarded" == 1
